class t{#t;setEventEmitter(t){return this.#t=t,this}unsetEventEmitter(){return this.#t=void 0,this}getEventEmitter(){return this.#t}}class e extends t{}const i="A".charCodeAt(0);function r(t,e=0){return t.charCodeAt(e)-i}function s(t){return String.fromCharCode(t+i)}function n(t,e){return s(g(r(t)+e))}function o(t){return n(t,1)}function h(t){return n(t,8)}function g(t,e=26){return(e+t)%e}const a=/^[A-Z]$/;function l(t){return a.test(t)}function c(t){const e=`${t}`.toUpperCase();if(l(e))return e.charAt(0);throw"Input cannot be normalized"}var u=Object.freeze({__proto__:null,getIndex:r,getLetter:s,getModularNumber:g,getNextLetter:o,getNotchLetter:h,getShiftedLetter:n,isUpperCaseLetter:l,normalizeInput:c});class d extends e{pinToPin(t){return r(this.wirings,t)}getReflectedLetter(t){const e=r(t.toUpperCase());return s(this.pinToPin(e))}}class p extends d{}class R extends p{wirings="ENKQAUYWJICOPBLMDXZVFTHRGS"}class f extends p{wirings="RDOBJNTKVEHMLFCWZAXGYIPSUQ"}class w extends d{wirings="EJMZALYXVBWFCRQUONTSPIKHGD"}class P extends d{wirings="YRUHQSLDPXNGOKMIEBFZCWVJAT"}class L extends d{wirings="LEYJVCNIXWPBQMDRTAKZGFUHOS"}class W extends d{wirings="FVPJIAOYEDRZXWGCTKUQSBNMHL"}class I extends d{#e=[[0,13]];plugWire(t,e){var i;if(this.#e.length>=13)throw"All plugs have been wired";if(!this.arePlugsWireable(t,e))throw"This couple is permanently wired and therefore cannot be plugged";if(t===e)throw"Cannot wire the same letter";if(!(t>=0&&t<26&&e>=0&&e<26))throw"Wiring indexes out of bounds";for(let i=0;i<this.#e.length;i+=1){const[r,s]=this.#e[i];if(r===t||s===t||r===e||s===e)throw"At least one of the plugs is already wired"}this.#e.push([t,e]),null===(i=this.getEventEmitter())||void 0===i||i.emit("change.wirePlugged",t,e)}arePlugsWireable(t,e){return!(0===t&&13===e||13===t&&0===e)}unplugWire(t,e){if(!this.arePlugsWireable(t,e))throw"This couple is permanently wired and therefore cannot be unplugged";for(let r=0;r<this.#e.length;r+=1){const[s,n]=this.#e[r];var i;if(s===t&&n===e||s===e&&n===t)this.#e.splice(r,1),null===(i=this.getEventEmitter())||void 0===i||i.emit("change.wireUnplugged",t,e)}}pinToPin(t){for(let e=0;e<this.#e.length;e+=1){const[i,r]=this.#e[e];if(i===t)return r;if(r===t)return i}throw"This pin is not wired"}getReflectedLetter(){throw"This method has various interpretations on this reflector"}getIndexFromGermanNotation(t){let e=r(t);if(9===e||24===e)throw"J and Y letters do not appear in German notation";return(e>8&&e<13||25===e)&&(e-=1),25-e}getIndexFromAlliedNotation(t){return g(r(t)+25)}plugWireInGermanNotation(t,e){this.plugWire(this.getIndexFromGermanNotation(t),this.getIndexFromGermanNotation(e))}unplugWireInGermanNotation(t,e){this.unplugWire(this.getIndexFromGermanNotation(t),this.getIndexFromGermanNotation(e))}plugWireInAlliedNotation(t,e){this.plugWire(this.getIndexFromAlliedNotation(t),this.getIndexFromAlliedNotation(e))}unplugWireInAlliedNotation(t,e){this.unplugWire(this.getIndexFromAlliedNotation(t),this.getIndexFromAlliedNotation(e))}}class m extends d{wirings="FSOKANUERHMBTIYCWLQPZXVGJD"}class O extends e{constructor(){super(),this.setRingPosition(0)}pinToPlate(t){return r(this.wirings,t)}plateToPin(t){return this.wirings.indexOf(s(t))}setRingPosition(t){var e;this.ringPosition=t,null===(e=this.getEventEmitter())||void 0===e||e.emit("change.ringPositionSet",t)}setRingSetting(t){var e;this.setRingPosition(r(t)),null===(e=this.getEventEmitter())||void 0===e||e.emit("change.ringSettingSet",t)}getOutputLetter(t){const e=g(r(t.toUpperCase())-this.ringPosition);return s(g(this.pinToPlate(e)+this.ringPosition))}getInputLetter(t){const e=g(r(t.toUpperCase())+this.ringPosition);return s(g(this.plateToPin(e)-this.ringPosition))}}class E extends O{}class x extends E{wirings="LEYJVCNIXWPBQMDRTAKZGFUHOS"}class T extends E{wirings="FSOKANUERHMBTIYCWLQPZXVGJD"}class F extends O{wirings="EKMFLGDQVZNTOWYHXUSPAIBRCJ";notchPosition="Y"}class C extends O{wirings="AJDKSIRUXBLHWTMCQGZNPYFVOE";notchPosition="M"}class N extends O{wirings="BDFHJLCPRTXVZNYEIWGAKMUSQO";notchPosition="D"}class v extends O{wirings="ESOVPZJAYQUIRHXLNFTGKDCMWB";notchPosition="R"}class A extends O{wirings="VZBRGITYUPSDNHLXAWMJQOFECK";notchPosition="H"}class S extends O{wirings="JPGVOUMFYQBENHZRDKASXLICTW";notchPosition="HU"}class B extends O{wirings="NZJHGRCXMYSWBOUFAIVLPEKQDT";notchPosition="HU"}class U extends O{wirings="FKQHTLXOCBJSPDZRAMEWNIUYGV";notchPosition="HU"}class D extends t{constructor(t,e){if(super(),this.firstLetter=c(t),this.secondLetter=c(e),this.firstLetter===this.secondLetter)throw new Error("Plugging the same letter")}}class G extends D{swap(t){return t===this.firstLetter?this.secondLetter:t===this.secondLetter?this.firstLetter:void 0}swapForward=this.swap.bind(this);swapBackward=this.swap.bind(this)}class M extends t{static DIRECTION_FORWARD="F";static DIRECTION_BACKWARDS="B";#i=[];plugWire(t,e){if(t instanceof D&&null==e){var i;for(let e=0;e<this.#i.length;e+=1){const{firstLetter:i,secondLetter:r}=this.#i[e];if(i===t.firstLetter||r===t.secondLetter||r===t.firstLetter||i===t.secondLetter)return!1}return this.#i.push(t),null===(i=this.getEventEmitter())||void 0===i||i.emit("change.wirePlugged",t.firstLetter,t.secondLetter),!0}return"string"==typeof t&&"string"==typeof e&&this.plugWire(new G(t,e))}unplugWire(t,e){if(t instanceof D&&null==e)for(let e=0;e<this.#i.length;e+=1){const{firstLetter:r,secondLetter:s}=this.#i[e];var i;if(r===t.firstLetter&&s===t.secondLetter||s===t.firstLetter&&r===t.secondLetter)return this.#i.splice(e,1),null===(i=this.getEventEmitter())||void 0===i||i.emit("change.wireUnplugged",t.firstLetter,t.secondLetter),!0}else if("string"==typeof t&&"string"==typeof e)return this.unplugWire(new G(t,e));return!1}plugWires(t){t.forEach((t=>{t instanceof Array?this.plugWire(t[0],t[1]):t instanceof D&&this.plugWire(t)}))}unplugAllWires(){this.#i.splice(0,this.#i.length)}getSwappedLetter(t,e){t=c(t);for(let i=0;i<this.#i.length;i+=1){const r="F"===e?this.#i[i].swapForward(t):this.#i[i].swapBackward(t);if(null!=r)return r}return t}}const H=[6,31,4,29,18,39,16,25,30,23,28,1,38,11,36,37,26,27,24,21,14,3,12,17,2,7,0,33,10,35,8,5,22,19,20,13,34,15,32,9],V=[6,0,7,5,1,8,4,2,9,3];class K extends t{#r={};#s=0;setUhrSetting(t){var e;this.#s=g(t,H.length),null===(e=this.getEventEmitter())||void 0===e||e.emit("change.uhrSetting",this.#s)}getUhrSetting(){return this.#s}getInnerPin(t){return g(H[g(t+this.#s,H.length)]-this.#s,H.length)}getOuterPin(t){const e=g(t+this.#s,H.length);return g(H.indexOf(e)-this.#s,H.length)}getIngoingBlackWire(t){const e=4*(t-1),i=this.getInnerPin(e);return V[(i-2)/4]+1}getOutgoingBlackWire(t){const e=4*(t-1)+2,i=this.getInnerPin(e);return V[i/4]+1}getIngoingRedWire(t){const e=4*V.indexOf(t-1);return(this.getOuterPin(e)-2)/4+1}getOutgoingRedWire(t){const e=4*V.indexOf(t-1)+2;return this.getOuterPin(e)/4+1}getUhrWire(t){return this.#r[t]}getUhrWires(){return Object.keys(this.#r).sort(((t,e)=>Number(e)-Number(t))).map((t=>this.#r[t]))}prepareUhrWire(t,e,i){const r=this,s=new class extends D{swapForward(e){return e===this.firstLetter?r.#r[r.getIngoingBlackWire(t)].secondLetter:e===this.secondLetter?r.#r[r.getIngoingRedWire(t)].firstLetter:void 0}swapBackward(e){return e===this.firstLetter?r.#r[r.getOutgoingBlackWire(t)].secondLetter:e===this.secondLetter?r.#r[r.getOutgoingRedWire(t)].firstLetter:void 0}}(e,i);return this.#r[t]=s,s}prepareUhrWires(t){t.forEach((([t,e],i)=>{this.prepareUhrWire(i+1,t,e)}))}}class Y extends e{getPlateFromLetter(t){return r(t)}getLetterFromPlate(t){return s(t)}}const J="L",Z="C",Q="R";class X{#t;plugBoard=new M;entryWheel=new Y;rotors={};rotorsWindowLetter={};constructor(t){this.#t=t,this.plugBoard.setEventEmitter(this.#t),this.setRotor(null,J),this.setRotor(null,Z),this.setRotor(null,Q)}getPlugBoard(){return this.plugBoard}setRotor(t,e){return t.setEventEmitter(this.#t),this.rotors[e]=t,this.#t.emit("change.rotorSet",t,e),this.setRotorWindowLetter("A",e),this}getRotor(t){return this.rotors[t]}setReflector(t){return t.setEventEmitter(this.#t),this.reflector=t,this.#t.emit("change.reflectorSet",t),this}setRotorWindowLetter(t,e){return this.rotorsWindowLetter[e]=t,this.#t.emit("change.rotorWindowLetterSet",t,e,this.getRotor(e)),this}getRotorWindowLetter(t){return this.rotorsWindowLetter[t]}isRotorInNotchPosition(t){const e=h(this.getRotorWindowLetter(t));return this.getRotor(t).notchPosition.indexOf(e)>-1}advanceRotor(t){return this.setRotorWindowLetter(o(this.getRotorWindowLetter(t)),t),this.#t.emit("change.rotorAdvanced",t,this.getRotor(t),this.getRotorWindowLetter(t)),this}advanceRotors(){const t=this.isRotorInNotchPosition(Z),e=this.isRotorInNotchPosition(Q);return t&&this.advanceRotor(J),(t||e)&&this.advanceRotor(Z),this.advanceRotor(Q),this.#t.emit("change.rotorsAdvanced"),this}encodeForward(t){const e=t.toUpperCase(),i=this.plugBoard.getSwappedLetter(e,M.DIRECTION_FORWARD),r=this.entryWheel.getPlateFromLetter(i),s=this.getRotorInputPosition(r,Q),n=this.getRotor(Q).pinToPlate(s),o=this.getRotorOutputPosition(n,Q),h=this.getRotorInputPosition(o,Z),g=this.getRotor(Z).pinToPlate(h),a=this.getRotorOutputPosition(g,Z),l=this.getRotorInputPosition(a,J),c=this.getRotor(J).pinToPlate(l);return this.getRotorOutputPosition(c,J)}encodeReflect(t){return this.reflector.pinToPin(t)}encodeBackwards(t){const e=this.getRotorInputPosition(t,J),i=this.getRotor(J).plateToPin(e),r=this.getRotorOutputPosition(i,J),s=this.getRotorInputPosition(r,Z),n=this.getRotor(Z).plateToPin(s),o=this.getRotorOutputPosition(n,Z),h=this.getRotorInputPosition(o,Q),g=this.getRotor(Q).plateToPin(h),a=this.getRotorOutputPosition(g,Q),l=this.entryWheel.getLetterFromPlate(a);return this.plugBoard.getSwappedLetter(l,M.DIRECTION_BACKWARDS)}getEncodedLetter(t){if(!this.isMachineValidState())throw"Machine is not in valid state";this.advanceRotors();const e=this.encodeForward(t),i=this.encodeReflect(e);return this.encodeBackwards(i)}getRotorInputPosition(t,e){return g(t+r(this.getRotorWindowLetter(e))-this.getRotor(e).ringPosition)}getRotorOutputPosition(t,e){return g(t-r(this.getRotorWindowLetter(e))+this.getRotor(e).ringPosition)}encode(t){let e="";for(let i=0;i<t.length;i+=1)e+=this.getEncodedLetter(t.charAt(i));return e}isMachineValidState(){return this.getRotor(J)instanceof O&&this.getRotor(Z)instanceof O&&this.getRotor(Q)instanceof O&&this.reflector instanceof d}static LEFT_ROTOR=J;static CENTER_ROTOR=Z;static RIGHT_ROTOR=Q}const b="F";class k extends X{constructor(){super(),this.setRotor(null,b)}encodeForward(t){const e=super.encodeForward(t);if(this.isClassicConfiguration())return e;{const t=this.getRotorInputPosition(e,b),i=this.getRotor(b).pinToPlate(t);return this.getRotorOutputPosition(i,b)}}encodeBackwards(t){let e;if(this.isClassicConfiguration())e=t;else{const i=this.getRotorInputPosition(t,b),r=this.getRotor(b).plateToPin(i);e=this.getRotorOutputPosition(r,b)}return super.encodeBackwards(e)}isClassicConfiguration(){return null===this.getRotor(b)&&this.reflector instanceof d&&!(this.reflector instanceof p)}isMachineValidState(){const t=super.isMachineValidState();return this.isClassicConfiguration()?t:t&&this.getRotor(b)instanceof E&&this.reflector instanceof p}static FOURTH_ROTOR=b}export{X as Enigma,k as EnigmaM4,M as PlugBoard,G as PlugBoardWire,w as ReflectorA,P as ReflectorB,L as ReflectorBeta,W as ReflectorC,I as ReflectorD,m as ReflectorGamma,F as RotorI,C as RotorII,N as RotorIII,v as RotorIV,A as RotorV,S as RotorVI,B as RotorVII,U as RotorVIII,R as ThinReflectorB,f as ThinReflectorC,x as ThinRotorBeta,T as ThinRotorGamma,K as Uhr,u as Utils};
